var K=t=>{throw TypeError(t)},Z=(t,e,n)=>e.has(t)||K("Cannot "+n),L=(t,e,n)=>(Z(t,e,"read from private field"),n?n.call(t):e.get(t)),se=(t,e,n)=>e.has(t)?K("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),P=(t,e,n,r)=>(Z(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);try{self["workbox:core:7.0.0"]&&_()}catch{}function ce(t){t.then(()=>{})}const le=(t,e)=>e.some(n=>t instanceof n);let U,F;function de(){return U||(U=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ue(){return F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const X=new WeakMap,q=new WeakMap,Q=new WeakMap,R=new WeakMap,H=new WeakMap;function he(t){const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(g(t.result)),a()},o=()=>{r(t.error),a()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&X.set(n,t)}).catch(()=>{}),H.set(e,t),e}function me(t){if(q.has(t))return;const e=new Promise((n,r)=>{const a=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),a()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});q.set(t,e)}let A={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return q.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Q.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function ge(t){A=t(A)}function pe(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(D(this),e,...n);return Q.set(r,e.sort?e.sort():[e]),g(r)}:ue().includes(t)?function(...e){return t.apply(D(this),e),g(X.get(this))}:function(...e){return g(t.apply(D(this),e))}}function fe(t){return typeof t=="function"?pe(t):(t instanceof IDBTransaction&&me(t),le(t,de())?new Proxy(t,A):t)}function g(t){if(t instanceof IDBRequest)return he(t);if(R.has(t))return R.get(t);const e=fe(t);return e!==t&&(R.set(t,e),H.set(e,t)),e}const D=t=>H.get(t);function be(t,e,{blocked:n,upgrade:r,blocking:a,terminated:i}={}){const o=indexedDB.open(t,e),c=g(o);return r&&o.addEventListener("upgradeneeded",s=>{r(g(o.result),s.oldVersion,s.newVersion,g(o.transaction),s)}),n&&o.addEventListener("blocked",s=>n(s.oldVersion,s.newVersion,s)),c.then(s=>{i&&s.addEventListener("close",()=>i()),a&&s.addEventListener("versionchange",l=>a(l.oldVersion,l.newVersion,l))}).catch(()=>{}),c}function we(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",r=>e(r.oldVersion,r)),g(n).then(()=>{})}const ve=["get","getKey","getAll","getAllKeys","count"],ke=["put","add","delete","clear"],S=new Map;function O(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(S.get(e))return S.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,a=ke.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(a||ve.includes(n)))return;const i=async function(o,...c){const s=this.transaction(o,a?"readwrite":"readonly");let l=s.store;return r&&(l=l.index(c.shift())),(await Promise.all([l[n](...c),a&&s.done]))[0]};return S.set(e,i),i}ge(t=>({...t,get:(e,n,r)=>O(e,n)||t.get(e,n,r),has:(e,n)=>!!O(e,n)||t.has(e,n)}));try{self["workbox:expiration:7.0.0"]&&_()}catch{}const ye="workbox-expiration",v="cache-entries",V=t=>{const e=new URL(t,location.href);return e.hash="",e.href};class xe{constructor(e){this._db=null,this._cacheName=e}_upgradeDb(e){const n=e.createObjectStore(v,{keyPath:"id"});n.createIndex("cacheName","cacheName",{unique:!1}),n.createIndex("timestamp","timestamp",{unique:!1})}_upgradeDbAndDeleteOldDbs(e){this._upgradeDb(e),this._cacheName&&we(this._cacheName)}async setTimestamp(e,n){e=V(e);const r={url:e,timestamp:n,cacheName:this._cacheName,id:this._getId(e)},a=(await this.getDb()).transaction(v,"readwrite",{durability:"relaxed"});await a.store.put(r),await a.done}async getTimestamp(e){const n=await(await this.getDb()).get(v,this._getId(e));return n==null?void 0:n.timestamp}async expireEntries(e,n){const r=await this.getDb();let a=await r.transaction(v).store.index("timestamp").openCursor(null,"prev");const i=[];let o=0;for(;a;){const s=a.value;s.cacheName===this._cacheName&&(e&&s.timestamp<e||n&&o>=n?i.push(a.value):o++),a=await a.continue()}const c=[];for(const s of i)await r.delete(v,s.id),c.push(s.url);return c}_getId(e){return this._cacheName+"|"+V(e)}async getDb(){return this._db||(this._db=await be(ye,1,{upgrade:this._upgradeDbAndDeleteOldDbs.bind(this)})),this._db}}class Te{constructor(e,n={}){this._isRunning=!1,this._rerunRequested=!1,this._maxEntries=n.maxEntries,this._maxAgeSeconds=n.maxAgeSeconds,this._matchOptions=n.matchOptions,this._cacheName=e,this._timestampModel=new xe(e)}async expireEntries(){if(this._isRunning){this._rerunRequested=!0;return}this._isRunning=!0;const e=this._maxAgeSeconds?Date.now()-this._maxAgeSeconds*1e3:0,n=await this._timestampModel.expireEntries(e,this._maxEntries),r=await self.caches.open(this._cacheName);for(const a of n)await r.delete(a,this._matchOptions);this._isRunning=!1,this._rerunRequested&&(this._rerunRequested=!1,ce(this.expireEntries()))}async updateTimestamp(e){await this._timestampModel.setTimestamp(e,Date.now())}async isURLExpired(e){if(this._maxAgeSeconds){const n=await this._timestampModel.getTimestamp(e),r=Date.now()-this._maxAgeSeconds*1e3;return n!==void 0?n<r:!0}else return!1}async delete(){this._rerunRequested=!1,await this._timestampModel.expireEntries(1/0)}}typeof registration<"u"&&registration.scope;const u="451-tools",I=["network-only","network-first","stale-while-revalidate"],Ce={"network-only":Ee,"network-first":Le,"stale-while-revalidate":Pe};function Ee({event:t,fetcher:e=fetch}){const{request:n}=t;return e(n)}function Le({cacheName:t,event:e,expirationManager:n,fetcher:r=fetch}){const{request:a}=e;return r(a).then(i=>{const o=i.clone();return i.ok&&caches.open(t).then(c=>c.put(a,o)).then(async()=>{n&&(await n.updateTimestamp(a.url),await n.expireEntries())}),i}).catch(()=>caches.open(t).then(i=>i.match(a,{ignoreSearch:!0})))}function Pe({cacheName:t,event:e,expirationManager:n,fetcher:r=fetch}){const{request:a}=e;return caches.open(t).then(i=>i.match(a,{ignoreSearch:!0})).then(async i=>i?(e.waitUntil(r(a).then(async o=>{if(o.ok){const c=o.clone();caches.open(t).then(s=>s.put(a.url,c)).then(async()=>{n&&(await n.updateTimestamp(a.url),await n.expireEntries())})}return o})),i):r(a).then(o=>o.ok?caches.open(t).then(c=>c.put(a,o.clone())).then(()=>o):o))}function _e(t){const e=JSON.stringify(t);return self.clients.matchAll().then(n=>Promise.all(n.map(r=>(r.postMessage(e),Promise.resolve("postMessage sent, ",e)))))}const ee="mirrors",te="/mirrors.json",Re=10*60*1e3,b="up",B="down";async function C(){return caches.open(ee).then(t=>t.match(te)).then(t=>t.json())}async function W(t){await caches.open(ee).then(e=>e.put(te,new Response(JSON.stringify(t),{headers:{"Content-Type":"application/json"}})))}async function z(t,e){const n=await C(),r=n.find(o=>o.url===t),a={...r,lastModified:Date.now(),status:e},i=[...n.filter(o=>o.url!==t),a];await W(i).then(()=>{r.status!==e&&_e({type:"mirror-status-changed",mirror:t,status:e})})}async function De(){const t=Date.now(),e=await C(),n=e.every(a=>a.status===B);let r;n?r=e.map(a=>({...a,lastModified:t,status:b})):r=e.map(a=>a.lastModified<t-Re?{...a,lastModified:t,status:b}:a),await W(r)}async function G(){const t=(await C()).filter(e=>e.status===b);return t.find(e=>e.isPrimary)||t[0]}async function j(t,e){const n=new URL(t.url),r=n.pathname,a=n.searchParams,i=t.destination==="document",{mirroring:o}=await e.getConfiguration(),c=o.timeout??3e3,s=r.replace(/^\//,"");let l=[];i&&await De();let m=await G();for(;m;){const d=m.url,h=new URL(s,d);h.search=a.toString();const $=new AbortController;try{const w=await Promise.race([Se(c),fetch(new Request(h,{...t,signal:$.signal}))]),E=new Headers(w.headers);return E.append("x-mirror",d),E.append("x-time-cached",Date.now()),await z(d,b),e.logger(`(mirroring) Request successful on mirror: ${d}, URL: ${h}`),new Response(w.body,{...w,headers:E})}catch(w){$.abort(),l.push(w),await z(d,B),e.logger(`(mirroring) Request failed on mirror: ${d}, URL: ${h}`)}m=await G()}return Promise.reject(new Error("networking.js (fetchFromMirrors): Out of mirrors.",{cause:l}))}function Se(t){return new Promise((e,n)=>{setTimeout(()=>{n(new Response("",{status:408,statusText:"Request Timeout"}))},t)})}const qe=()=>({});function ne(t,e){return e?`${t}?revision=${e}`:t}const Ae=t=>!t||!t.pages?(console.warn("[content-bundles]: No configuration provided"),{pages:[]}):{pages:(Array.isArray(t.pages)?t.pages:[t.pages]).map(e=>{const{metadata:n={}}=e;return typeof e=="string"?{url:e,revision:null,metadata:n}:{url:e.url,revision:e.revision||null,metadata:n}})},Ie=t=>{if(!t||!t.assets)throw new Error("Missing offlineAssets.assets in configuration.");return{assets:(Array.isArray(t.assets)?t.assets:[t.assets]).map(e=>typeof e=="string"?{url:e,revision:null}:{url:e.url,revision:e.revision||null})}},Me=()=>({});function He({language:t,textDirection:e,templateStrings:n,mainCSS:r,mainJS:a}){return{"{{ language }}":t,"{{ textDirection }}":e,"{{ mainCSS }}":r,"{{ mainJS }}":a,"{{ pageTitle }}":(n==null?void 0:n.pageTitle)||"451 Tools","{{ pageDescription }}":(n==null?void 0:n.pageDescription)||"Censorship Resilient and Distributed Publishing","{{ homeLinkText }}":(n==null?void 0:n.homeLinkText)||"Home","{{ bookmarksTabTitle }}":(n==null?void 0:n.bookmarksTabTitle)||"Bookmarks","{{ editorialTabTitle }}":(n==null?void 0:n.editorialTabTitle)||"Editorial","{{ aboutTabTitle }}":(n==null?void 0:n.aboutTabTitle)||"About","{{ copyright }}":(n==null?void 0:n.copyright)||`Copyright © ${new Date().getFullYear()}, Zamaneh Media. All rights reserved.`,"{{ aboutInnerHTML }}":(n==null?void 0:n.aboutInnerHTML)||`
      <p>You are on the 451 Tools offline dashboard. This could be because you are experiencing an internet shutdown or your device is not connected to the internet. 451 Tools keeps information available even when the website is censored or when the internet is down.</p>
      <p>451 Tools helps publishers maintain reach and readership under the most adversarial circumstances. Find out more at <a href="https://451.tools/" target="_blank">https://451.tools/</a>.</p>
    `}}const Be='<!doctypehtml><html lang="{{ language }}"dir="{{ textDirection }}"><meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="{{ pageDescription }}"><title>{{ pageTitle }}</title><style>{{ mainCSS }}</style><div class="container"><header class="header"><a class="home-link"href="/"><svg xmlns="http://www.w3.org/2000/svg"fill="currentColor"viewBox="0 0 16 16"width="28"height="28"><path d="M8 1.32.66 8.133l.68.734.66-.613V14h5V9h2v5h5V8.254l.66.613.68-.734Zm0 1.36 5 4.648V13h-3V8H6v5H3V7.328Z"/></svg> <span class="link-text">{{ homeLinkText }}</span></a><h1 class="title">{{ pageTitle }}</h1><p class="description">{{ pageDescription }}</p><svg class="offline-icon"xmlns="http://www.w3.org/2000/svg"viewBox="0 0 500 500"aria-hidden="true"><path d="M355.5 105.5c11.4 36.1 17.7 73.6 18.7 111.4 4.3.5 8.5 1.1 12.6 2h69.8c-3.2-52.6-25.4-102.2-62.1-139.9-12.2 10-25.3 18.9-39 26.5M99 405.2c.7.7 1.5 1.3 2.1 1.8 2.1 1.6 4.4 3.1 6.5 4.7 3.2 2.3 6.5 4.5 9.7 6.6 2.3 1.5 4.7 2.8 6.9 4.2 3.4 1.9 6.6 3.9 10 5.6 2.4 1.3 4.9 2.5 7.4 3.7 3.2 1.6 6.8 3.1 10 4.7 2.4 1 4.7 2 7.1 2.8-12.9-16.2-23.6-34.1-31.5-53.4-10 5.7-19.3 12.1-28.2 19.3m171.2-158.9h-19.9v19.2c6-7 12.7-13.4 19.9-19.2m175.6.2c3.6 2.8 7 5.8 10.2 9 .3-3 .6-6 .8-9h-11M250.3 13.8v94.1c24.3-1.5 48-6.9 70.4-16.3-17.6-41.8-42.6-70.5-70.4-77.8m123.9 46.4-2.1-1.8c-2.1-1.6-4.4-3.1-6.5-4.7-3.2-2.3-6.5-4.5-9.7-6.6-2.3-1.5-4.7-2.7-6.9-4.2-3.4-1.9-6.6-3.9-10-5.7-2.5-1.3-4.9-2.5-7.4-3.7-3.2-1.6-6.8-3.2-10-4.7-2.4-1-4.7-1.9-7.1-2.7 13 16.2 23.6 34.1 31.5 53.4 9.9-5.7 19.3-12.2 28.2-19.3M250.3 218.8h78.8c5.7-1.2 11.5-2 17.4-2.4-1.2-33.5-6.6-66.7-16.4-98.8-25.4 10.3-52.4 16.3-79.7 17.8l-.1 83.4m-27.5 232.6v-51.7c-4.1-13.1-6.3-26.7-6.4-40.4V358c-22 2-43.5 7.2-63.9 15.7 17.6 41.6 42.5 70.4 70.3 77.7m-105.1-91.5c-11.6-36.7-18-74.9-18.7-113.4H16.6c3.2 52.6 25.4 102.2 62.1 139.9 12.2-10 25.3-18.9 39-26.5M16.3 218.8h82.5c1-38.5 7.1-76.7 18.7-113.4-13.8-7.6-26.8-16.5-39-26.5-36.7 37.7-58.6 87.4-62.2 139.9m235.3 232.1c-.4-.5-.8-1-1.3-1.5v2c.5-.1.9-.3 1.4-.4 0-.1-.1-.1-.1-.1m-125-204.4c1 34.3 6.5 68.4 16.5 101.3 24.2-9.9 49.9-15.7 75.9-17.5.2-1.2.4-2.4.7-3.5.9-3.9 1.9-7.8 3.1-11.6v-68.7h-96.2M159 26.2c-2.4.8-4.7 1.8-7.1 2.7-3.5 1.5-6.9 2.9-10.3 4.5-2.5 1.2-5 2.4-7.4 3.7-3.4 1.6-6.6 3.6-9.9 5.5-2.4 1.5-4.9 2.9-7.1 4.4-3.3 2.1-6.4 4.3-9.6 6.6-2.1 1.6-4.4 3.2-6.5 4.9-.6.5-1.3 1.1-1.9 1.8 8.9 7.3 18.4 13.6 28.3 19.2 7.8-19.1 18.5-37.1 31.5-53.3m-6.5 65.5c22.4 9.2 46.2 14.7 70.3 16.2v-94c-27.8 7.3-52.7 36.3-70.3 77.8m70.3 43.7c-27.5-1.5-54.3-7.4-79.7-17.8-10 32.8-15.5 66.9-16.5 101.2h96.2v-83.4m246.4 163.3c-6.1-11.7-14-22.4-23.3-31.7-10.7-10.7-23.3-19.4-37.1-25.7l-2.1-.9c-15.7-6.8-33-10.6-51.2-10.6-18.1 0-35.3 3.7-50.9 10.5-37.3 16.1-65.4 49.4-74.3 89.9-2.1 9.7-3.2 19.6-3 29.5.2 13.2 2.4 26.4 6.6 39 5.4 16.2 14 31.2 25.3 44 12.7 14.5 28.5 25.9 46.3 33.5 15.4 6.5 32.3 10.1 50.1 10.1 70.8 0 128.2-57.4 128.2-128.2-.1-21.5-5.3-41.6-14.6-59.4zm-43.9 107-22.1 22.1-47.7-47.7-47.7 47.7-22.1-22.1 47.7-47.7-47.7-47.7 22.1-22.1 47.7 47.7 47.7-47.7 22.1 22.1-47.7 47.7 47.7 47.7z"/></svg></header><main class="main-content"><div class="tabs"role="tablist"><button aria-controls="panel-1"aria-selected="false"class="tab tab__hidden"id="tab-1"role="tab"tabindex="-1"disabled="disabled">{{ bookmarksTabTitle }}</button> <button aria-controls="panel-2"aria-selected="false"class="tab tab__hidden"id="tab-2"role="tab"tabindex="-1"disabled="disabled">{{ editorialTabTitle }}</button> <button aria-controls="panel-3"aria-selected="false"class="tab"id="tab-3"role="tab"tabindex="-1">{{ aboutTabTitle }}</button></div><section aria-labelledby="tab-1"class="tab-content"data-bookmarks hidden id="panel-1"role="tabpanel"tabindex="0"></section><section aria-labelledby="tab-2"class="tab-content"data-editorial hidden id="panel-2"role="tabpanel"tabindex="0"></section><section aria-labelledby="tab-3"class="tab-content rich-text"hidden id="panel-3"role="tabpanel"tabindex="0">{{ aboutInnerHTML }}</section></main><footer><p class="copyright">{{ copyright }}</footer></div><script>{{ mainJS }}<\/script>',J='*,::after,::before{box-sizing:border-box}*{margin:0}body,html{height:100%}body{-webkit-font-smoothing:antialiased;background-color:var(--background-color,#f9fbfc);color:var(--text-color,#2d2d3b);font-family:system-ui,sans-serif;line-height:1.4}.container{display:flex;flex-direction:column;height:100%;margin:0 auto;max-width:var(--container-width,1200px);padding:0 2rem;width:100%}.header{margin:4rem 0 2.5rem;position:relative}.home-link{display:flex;align-items:center;gap:.5rem;color:var(--primary-color,#1993f6);margin-block-end:1rem;text-decoration:none}.home-link:hover .link-text{text-decoration:underline}.home-link svg{width:28px;height:28px}.title{font-size:2.75rem;line-height:1;margin-block-end:1.5rem}@media screen and (min-width:960px){.title{font-size:5rem}}.description{font-size:1.25rem;max-width:40rem}.offline-icon{display:none;fill:var(--icon-color,#e6e8ec);height:100%;position:absolute;inset-inline-end:0;inset-block-start:0;z-index:-1}@media screen and (min-width:960px){.offline-icon{display:initial}}.main-content{flex-grow:1}.tabs{display:flex;flex-direction:row;flex-wrap:wrap;list-style:none;margin-block-end:2rem;padding:0}@media screen and (min-width:485px){.tabs{border-block-end:1px solid var(--border-color,#e6e8ec);flex-wrap:nowrap;overflow:auto}}.tab{appearance:none;background:0 0;border:none;border-block-end:2px solid transparent;box-shadow:0 1px 0 0 var(--border-color,#e6e8ec);color:var(--tab-text-color,#7a7d95);cursor:pointer;font:inherit;font-size:1.25rem;font-weight:700;padding:.5rem 1rem;transition:border-color .2s ease-in-out;width:50%}@media screen and (min-width:485px){.tab{box-shadow:none;width:initial}}.tab__hidden{display:none}.tab:disabled{cursor:not-allowed;opacity:.5;order:1}.tab:disabled::before{content:"🔒";margin-inline-end:.25rem}.tab[aria-selected=true]{border-color:var(--primary-color,#1993f6);color:var(--primary-color,#1993f6)}.tab:hover:not(:disabled){border-color:var(--primary-color,#1993f6)}.rich-text{max-width:40rem}.rich-text>*+*{margin-block-start:1.5rem}.rich-text h2,.rich-text h3{line-height:1.25}.rich-text h2{font-size:2.25rem}@media screen and (min-width:960px){.rich-text h2{font-size:2.75rem}}.rich-text h3{font-size:1.75rem}@media screen and (min-width:960px){.rich-text h3{font-size:2.25rem}}.rich-text a{color:var(--primary-color,#1993f6)}.rich-text blockquote{border-inline-start:0.25rem solid var(--primary-color,#1993f6);padding-inline-start:1rem}.rich-text cite,.rich-text figcaption{display:block;font-style:italic;margin-block-start:0.5rem}.rich-text figcaption{text-align:center}.rich-text img{display:block;margin-inline-start:auto;margin-inline-end:auto;max-width:100%}.rich-text ol,.rich-text ul{list-style-position:inside;padding:0}.bookmarks,.content-bundles{display:flex;flex-wrap:wrap;gap:1.5rem;list-style:none;padding:0}.card{background-color:var(--card-background-color,#fff);border-radius:.5rem;border:1px solid var(--border-color,#e6e8ec);box-shadow:var(--card-box-shadow,0 8px 24px rgba(149,157,165,.2));width:100%}@media screen and (min-width:960px){.card{width:calc(50% - .75rem)}}.card-link{border-radius:.5rem;color:inherit;display:flex;height:100%;overflow:hidden;text-decoration:none;transition:box-shadow .2s ease-in-out}.card-link:hover{box-shadow:0 0 0 2px var(--primary-color,#1993f6)}.card-image{flex-shrink:0;height:100%;min-height:100px;object-fit:cover;width:100px}.card-image[src=""]{display:none}.card-content{padding:1rem}.card-title{font-size:1.25rem}.card-description,.card-title{-webkit-box-orient:vertical;-webkit-line-clamp:2;display:-webkit-box;overflow-wrap:break-word;overflow:hidden;word-break:break-word}.card-description:not(:empty){-webkit-line-clamp:3;margin-block-start:0.5rem}.copyright{margin:2rem 0;text-align:center}',We=`(async function(){const bookmarksPlaceholder=document.querySelector("[data-bookmarks]");const serviceWorkerRegistration=await navigator.serviceWorker.getRegistration();if(!serviceWorkerRegistration){return}let configuration;try{configuration=await caches.open("configuration").then((cache=>cache.match("/configuration.json"))).then((res=>res.json()))}catch{configuration={}}if(configuration.bookmark){const bookmarks=await fetch("/451-tools/bookmark/").then((res=>res.json())).catch((()=>[]));if(bookmarks.length<1){renderNoBookmarks()}else{const bookmarksList=document.createElement("ul");const bookmarksHtml=bookmarks.map(generateCardHtml).join("");bookmarksList.innerHTML=bookmarksHtml;bookmarksList.classList.add("bookmarks");bookmarksPlaceholder.appendChild(bookmarksList)}const bookmarksTab=document.querySelector("#tab-1");bookmarksTab.classList.remove("tab__hidden");bookmarksTab.removeAttribute("disabled")}else if(configuration.fallbackPages.showHiddenTabs){const bookmarksTab=document.querySelector("#tab-1");bookmarksTab.classList.remove("tab__hidden")}function renderNoBookmarks(){const noBookmarksMessage=document.createElement("p");noBookmarksMessage.innerText="You have no bookmarks.";bookmarksPlaceholder.appendChild(noBookmarksMessage)}const contentBundlesPlaceholder=document.querySelector("[data-editorial]");const isContentBundlesUsed=await caches.has("451-tools-content-bundles");if(isContentBundlesUsed){const contentBundles=await caches.open("451-tools-content-bundles").then((cache=>cache.keys())).then((requests=>Promise.all(requests.map((async request=>{const response=await caches.match(request);const html=await response.text();return{path:new URL(request.url).pathname,url:request.url.split("?")[0],html:html}})))));if(contentBundles.length<1){renderNoContentBundles()}else{const contentBundlesList=document.createElement("ul");const contentBundlesHtml=contentBundles.reverse().map(generateCardHtml).join("");contentBundlesList.innerHTML=contentBundlesHtml;contentBundlesList.classList.add("content-bundles");contentBundlesPlaceholder.appendChild(contentBundlesList)}const contentBundlesTab=document.querySelector("#tab-2");contentBundlesTab.classList.remove("tab__hidden");contentBundlesTab.removeAttribute("disabled")}else if(configuration.fallbackPages.showHiddenTabs){const contentBundlesTab=document.querySelector("#tab-2");contentBundlesTab.classList.remove("tab__hidden")}function renderNoContentBundles(){const noContentBundlesMessage=document.createElement("p");noContentBundlesMessage.innerText="You have no content bundles.";contentBundlesPlaceholder.appendChild(noContentBundlesMessage)}function generateCardHtml(response){const cardItem=document.createElement("li");const cardLink=document.createElement("a");const cardImage=document.createElement("img");const cardContent=document.createElement("div");const cardTitle=document.createElement("h2");const cardDescription=document.createElement("p");const html=document.createElement("html");html.innerHTML=response.html;const title=response.metadata?.title||html.querySelector("title")?.innerText||response.url;const description=response.metadata?.description||html.querySelector('meta[name="description"]')?.content||"";const imageSrc=response.metadata?.image?.src||html.querySelector('meta[property="og:image"]')?.content||"";cardItem.classList.add("card");cardLink.classList.add("card-link");cardLink.href=response.path;cardImage.classList.add("card-image");cardImage.src=imageSrc;if(Number.isInteger(response.metadata?.image?.height)){cardImage.height=response.metadata.image.height}if(Number.isInteger(response.metadata?.image?.width)){cardImage.width=response.metadata.image.width}cardImage.alt="";cardContent.classList.add("card-content");cardTitle.classList.add("card-title");cardTitle.innerText=title;cardDescription.classList.add("card-description");cardDescription.innerText=description;cardContent.appendChild(cardTitle);cardContent.appendChild(cardDescription);cardLink.appendChild(cardImage);cardLink.appendChild(cardContent);cardItem.appendChild(cardLink);return cardItem.outerHTML}const activeTabs=Array.from(document.querySelectorAll('[role="tab"]')).filter((tab=>!tab.classList.contains("tab__hidden")&&!tab.hasAttribute("disabled")));const firstActiveTab=activeTabs[0];const firstActivePanel=document.querySelector(\`#\${firstActiveTab.getAttribute("aria-controls")}\`);const tabList=document.querySelector('[role="tablist"]');firstActiveTab.setAttribute("aria-selected",true);firstActiveTab.setAttribute("tabindex",0);firstActivePanel.removeAttribute("hidden");activeTabs.forEach((tab=>tab.addEventListener("click",changeTabs)));let currentTabIndex=0;tabList.addEventListener("keydown",(e=>{if(e.key==="ArrowRight"||e.key==="ArrowLeft"){activeTabs[currentTabIndex].setAttribute("tabindex",-1);if(e.key==="ArrowRight"){currentTabIndex++;if(currentTabIndex>=activeTabs.length){currentTabIndex=0}}else if(e.key==="ArrowLeft"){currentTabIndex--;if(currentTabIndex<0){currentTabIndex=activeTabs.length-1}}activeTabs[currentTabIndex].setAttribute("tabindex",0);activeTabs[currentTabIndex].focus()}}));function changeTabs(e){const target=e.target;const parent=target.parentNode;const grandparent=parent.parentNode;parent.querySelectorAll('[aria-selected="true"]').forEach((t=>t.setAttribute("aria-selected",false)));target.setAttribute("aria-selected",true);grandparent.querySelectorAll('[role="tabpanel"]').forEach((p=>p.setAttribute("hidden",true)));grandparent.parentNode.querySelector(\`#\${target.getAttribute("aria-controls")}\`).removeAttribute("hidden")}})();
`;function N(t,e){const n=new URL(t.url).pathname;return e.some(r=>{try{return new RegExp(r).test(n)}catch{return!1}})}const je=async(t={})=>{const{serviceWorkerController:e}=t;if(!e)throw new Error("You must pass a serviceWorkerController plugin to registerFallbackPages");e.modules.push("fallback-pages"),e.logger("(fallback-pages) Module registered."),e.addInstallHandler(Ne),e.addActivateHandler($e),e.addFallbackHandler(({event:r})=>r.request.destination==="document",Ue);const n=({event:r})=>new RegExp(`/${u}/dashboard/?$`).test(r.request.url);e.addRoute(n,async r=>{const{fallbackPages:a}=await e.getConfiguration(),{language:i,textDirection:o,customProperties:c,templateStrings:s}=a;return new Response(re({language:i,textDirection:o,customProperties:c,templateStrings:s}),{headers:{"Content-Type":"text/html"}})},"GET")};async function Ne({serviceWorkerController:t}){const{fallbackPages:e}=await t.getConfiguration();if(e)return e.pages.map(n=>{const r=ne(n.url,n.revision);return Promise.all([caches.open(`${u}-fallback-pages`).then(a=>a.add(r))])})}async function $e({serviceWorkerController:t}){const{fallbackPages:e}=await t.getConfiguration(),n=e==null?void 0:e.pages.map(r=>ne(r.url,r.revision));return caches.open(`${u}-fallback-pages`).then(r=>r.keys().then(a=>{a.forEach(i=>{const o=i.url.replace(self.location.origin,"");if(!n.includes(o))return r.delete(i)})}))}async function Ue({event:t,serviceWorkerController:e}){const{fallbackPages:n}=await e.getConfiguration(),{customProperties:r,excludeByPath:a,language:i,pages:o,templateStrings:c,textDirection:s}=n;if(N(t.request,a))return;if(o.length<1)return e.logger("(fallback-pages) No custom fallback pages configured. Returning the default fallback page."),new Response(re({language:i,textDirection:s,customProperties:r,templateStrings:c}),{headers:{"Content-Type":"text/html"}});const l=o.find(d=>d.refererRegex?new RegExp(d.refererRegex).test(t.request.headers.get("referer")):!1),m=l?l.url:o.find(d=>!d.refererRegex).url;return caches.open(`${u}-fallback-pages`).then(d=>d.match(m,{ignoreSearch:!0}).then(h=>(h&&e.logger("(fallback-pages) Custom fallback page found. Returning cached response."),h)))}function re({language:t,textDirection:e,customProperties:n,templateStrings:r}){const a=n?`:root { ${Object.entries(n).map(([o,c])=>`--${o}: ${c};`).join(" ")} } ${J}`:J,i=He({language:t,textDirection:e,templateStrings:r,mainCSS:a,mainJS:We});return Be.replace(/{{\s?(.*?)\s?}}/g,(o,c)=>i[o]||o)}const Fe=t=>{const e=(t==null?void 0:t.customProperties)||{},n=(t==null?void 0:t.templateStrings)||{},r=(t==null?void 0:t.language)||"en",a=(t==null?void 0:t.textDirection)||"ltr",i=(t==null?void 0:t.showHiddenTabs)||!1,o=(t==null?void 0:t.excludeByPath)||[],c=(t!=null&&t.pages?Array.isArray(t.pages)?t.pages:[t.pages]:[]).map(s=>typeof s=="string"?{url:s,revision:null,refererRegex:null}:{url:s.url,revision:s.revision||null,refererRegex:s.refererRegex||null});return{language:r,textDirection:a,customProperties:e,templateStrings:n,showHiddenTabs:i,excludeByPath:o,pages:c}};try{self["workbox:core:7.0.0"]&&_()}catch{}const Oe=(t,...e)=>{let n=t;return e.length>0&&(n+=` :: ${JSON.stringify(e)}`),n},Ve=Oe;class M extends Error{constructor(e,n){const r=Ve(e,n);super(r),this.name=e,this.details=n}}try{self["workbox:routing:7.0.0"]&&_()}catch{}const ae="GET",x=t=>t&&typeof t=="object"?t:{handle:t};class y{constructor(e,n,r=ae){this.handler=x(n),this.match=e,this.method=r}setCatchHandler(e){this.catchHandler=x(e)}}class ze extends y{constructor(e,n,r){const a=({url:i})=>{const o=e.exec(i.href);if(o)return i.origin!==location.origin&&o.index!==0?void 0:o.slice(1)};super(a,n,r)}}class Ge{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",e=>{const{request:n}=e,r=this.handleRequest({request:n,event:e});r&&e.respondWith(r)})}addCacheListener(){self.addEventListener("message",e=>{if(e.data&&e.data.type==="CACHE_URLS"){const{payload:n}=e.data,r=Promise.all(n.urlsToCache.map(a=>{typeof a=="string"&&(a=[a]);const i=new Request(...a);return this.handleRequest({request:i,event:e})}));e.waitUntil(r),e.ports&&e.ports[0]&&r.then(()=>e.ports[0].postMessage(!0))}})}handleRequest({request:e,event:n}){const r=new URL(e.url,location.href);if(!r.protocol.startsWith("http"))return;const a=r.origin===location.origin,{params:i,route:o}=this.findMatchingRoute({event:n,request:e,sameOrigin:a,url:r});let c=o&&o.handler;const s=e.method;if(!c&&this._defaultHandlerMap.has(s)&&(c=this._defaultHandlerMap.get(s)),!c)return;let l;try{l=c.handle({url:r,request:e,event:n,params:i})}catch(d){l=Promise.reject(d)}const m=o&&o.catchHandler;return l instanceof Promise&&(this._catchHandler||m)&&(l=l.catch(async d=>{if(m)try{return await m.handle({url:r,request:e,event:n,params:i})}catch(h){h instanceof Error&&(d=h)}if(this._catchHandler)return this._catchHandler.handle({url:r,request:e,event:n});throw d})),l}findMatchingRoute({url:e,sameOrigin:n,request:r,event:a}){const i=this._routes.get(r.method)||[];for(const o of i){let c;const s=o.match({url:e,sameOrigin:n,request:r,event:a});if(s)return c=s,(Array.isArray(c)&&c.length===0||s.constructor===Object&&Object.keys(s).length===0||typeof s=="boolean")&&(c=void 0),{route:o,params:c}}return{}}setDefaultHandler(e,n=ae){this._defaultHandlerMap.set(n,x(e))}setCatchHandler(e){this._catchHandler=x(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new M("unregister-route-but-not-found-with-method",{method:e.method});const n=this._routes.get(e.method).indexOf(e);if(n>-1)this._routes.get(e.method).splice(n,1);else throw new M("unregister-route-route-not-registered")}}let k;const Je=()=>(k||(k=new Ge,k.addFetchListener(),k.addCacheListener()),k);function p(t,e,n){let r;if(typeof t=="string"){const a=new URL(t,location.href),i=({url:o})=>o.href===a.href;r=new y(i,e,n)}else if(t instanceof RegExp)r=new ze(t,e,n);else if(typeof t=="function")r=new y(t,e,n);else if(t instanceof y)r=t;else throw new M("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return Je().registerRoute(r),r}const Ye=async(t={})=>{const{serviceWorkerController:e}=t;if(!e)throw new Error("You must pass a serviceWorkerController plugin to registerMirroring");e.modules.push("mirroring");const n=new Te(`${u}-mirroring`,{maxEntries:20});e.logger("(mirroring) Module registered"),e.addInstallHandler(Ke),e.addRoute(Xe,a=>et({...a,expirationManager:n}),"GET"),e.addRoute(Qe,tt,"GET");const r=({event:a})=>new URL(a.request.url).pathname===`/${u}/mirror-status/`;e.addRoute(r,nt,"GET"),e.logger(`(mirroring) GET "/${u}/mirror-status/" endpoint registered.`)};async function Ke({serviceWorkerController:t}){const{mirroring:e}=await t.getConfiguration(),{urls:n}=e,r=n.map(a=>{const i=Date.now();return{url:a.url,lastModified:i,status:b,isPrimary:a.isPrimary}});return W(r)}const Ze=t=>{const e=self.location.origin,n=(t==null?void 0:t.urls)||[],r=[{url:e,isPrimary:!0},...n.map(i=>({url:i,isPrimary:!1}))],a=t!=null&&t.strategy&&I.includes(t.strategy)?t.strategy:"network-only";return{urls:r,excludeByPath:(t==null?void 0:t.excludeByPath)||[],timeout:(t==null?void 0:t.timeout)||3e3,strategy:a}};function Xe({event:t}){return t.request.destination==="document"}function Qe({event:t}){const e=new URL(t.request.url).pathname;return t.request.method==="GET"&&new URL(t.request.url).origin===new URL(self.registration.scope).origin&&!e.startsWith(`/${u}`)}async function et({event:t,serviceWorkerController:e,expirationManager:n}){const r=await e.getConfiguration(),{mirroring:a}=r,{strategy:i}=a,{request:o}=t;if(N(o,a.excludeByPath))return fetch(o);const c=Ce[i];return c({event:t,cacheName:`${u}-mirroring`,fetcher:s=>j(s,e),expirationManager:n})}async function tt({event:t,serviceWorkerController:e}){const{request:n}=t,{mirroring:r}=await e.getConfiguration();return N(n,r.excludeByPath)?fetch(n):j(n,e).catch(async()=>{e.logger(`(mirroring) All mirrors failed. Reverting to offline fallback handling for URL: ${n.url}`);const a=await e.handlerDidError({event:t,request:n});if(a)return a})}async function nt(){let t="unknown";const e=await C(),n=e.find(i=>i.isPrimary&&i.status===b),r=e.find(i=>i.status===b),a=e.every(i=>i.status===B);return n?t="up":r?t="low":a&&(t="down"),new Response(JSON.stringify({status:t}),{status:200,headers:{"Content-Type":"application/json"}})}function rt(t){return t?t.map(({urlPattern:e,strategy:n})=>{try{new RegExp(e)}catch{throw new Error(`[caching-strategies]: Invalid regex for URL pattern: ${e}`)}if(!I.includes(n))throw new Error(`[caching-strategies]: Invalid strategy: ${n}, must be one of: ${I.join(", ")}`);return{urlPattern:e,strategy:n}}):(console.warn("[caching-strategies]: No configuration provided"),[])}const at="configuration",it=24*60*60*1e3;async function T({configurationFilePath:t,serviceWorkerController:e}){const n=new Request(t,{cache:"no-store"});return e.fetcher(n).then(async r=>{if(r.ok){const a=await r.json();return ie({configuration:a,serviceWorkerController:e})}}).catch(r=>{console.error("Failed to fetch configuration:",r)})}async function ie({configuration:t,serviceWorkerController:e}){const{modules:n}=e;return caches.open(at).then(async r=>{const a={...t,...n.includes("bookmark")&&{bookmark:qe()},...n.includes("fallback-pages")&&{fallbackPages:Fe(t.fallbackPages)},...n.includes("fallback-image")&&{fallbackImage:Me()},...n.includes("offline-assets")&&{offlineAssets:Ie(t.offlineAssets)},...n.includes("content-bundles")&&{contentBundles:Ae(t.contentBundles)},...n.includes("caching-strategies")&&{cachingStrategies:rt(t.cachingStrategies)},...n.includes("mirroring")&&{mirroring:Ze(t.mirroring)},debugMode:t.debugMode||!1},i=new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json","Last-Modified":new Date().toUTCString()}});return await r.put("/configuration.json",i.clone()),e.setConfiguration(a),i})}async function ot(t){const e=await caches.open("configuration").then(r=>r.match("/configuration.json")).then(r=>r?r.headers.get("Last-Modified"):null);if(!e)return T({configurationFilePath:this.configurationFilePath,serviceWorkerController:t});const n=new Date(e).getTime()+it;return Date.now()>n&&(t.logger("(service-worker-controller) Configuration expired, fetching new configuration."),await T({configurationFilePath:t.configurationFilePath,serviceWorkerController:t}).then(()=>t.onInstall()).then(()=>t.onActivate())),Promise.resolve()}async function Y(t,e){for(const[n,r]of t.entries())if(await e(r,n,t))return r}var f;class st{constructor(){se(this,f,{}),this.configurationFilePath=new URL(self.location).searchParams.get("configuration"),this.modules=[],this.installHandlers=[],this.activateHandlers=[],this.fallbackHandlers=[],this.routes=[],this.init()}fetcher(e){return(this.modules.includes("mirroring")&&self.serviceWorker.state==="activated"?n=>j(n,this):fetch)(e)}async getConfiguration(){return Object.entries(L(this,f)).length?L(this,f):caches.open("configuration").then(e=>e.match("/configuration.json")).then(async e=>e?(P(this,f,await e.json()),L(this,f)):Promise.reject(new Error("Configuration not found")))}setConfiguration(e){P(this,f,e)}addInstallHandler(e){this.installHandlers.push(e)}addActivateHandler(e){this.activateHandlers.push(e)}addRoute(e,n,r="GET"){this.routes.push({matcher:e,handler:n,method:r})}addFallbackHandler(e,n){this.fallbackHandlers.push({matcher:e,handler:n})}async handlerDidError(e){const n=await this.getConfiguration(),r=await Y(this.fallbackHandlers,async({matcher:a})=>await a({event:e,configuration:n}));return r?r.handler({event:e,serviceWorkerController:this}):Response.error()}async cleanupUnusedCaches(){const e=(await caches.keys()).filter(n=>n.startsWith(`${u}-`)&&!this.modules.some(r=>n.slice(`${u}-`.length).startsWith(r)));await Promise.all(e.map(n=>caches.delete(n))),e.length>0&&this.logger(`(service-worker-controller) Cleaned up ${e.length} unused cache(s): ${e.join(", ")}`)}onInstall(){return Promise.all(this.installHandlers.map(e=>e({serviceWorkerController:this})))}onActivate(){return Promise.all([this.cleanupUnusedCaches(),...this.activateHandlers.map(e=>e({serviceWorkerController:this}))])}async init(){self.serviceWorker.state==="activated"&&ot(this),self.addEventListener("install",e=>{this.configurationFilePath?e.waitUntil(T({configurationFilePath:this.configurationFilePath,serviceWorkerController:this}).then(()=>this.onInstall()).then(()=>self.skipWaiting())):e.waitUntil(this.onInstall().then(()=>self.skipWaiting()))}),self.addEventListener("activate",e=>{e.waitUntil(this.onActivate().then(()=>self.clients.claim()))}),p(`/${u}/configuration/`,async({request:e})=>{try{const n=await e.json(),r=await ie({configuration:n,serviceWorkerController:this}).then(a=>a.json());return await this.onInstall().then(this.onActivate()),P(this,f,r),new Response(null,{status:200,statusText:"Configuration saved."})}catch{return new Response(null,{status:500,statusText:"Failed to save configuration."})}},"PUT"),this.logger(`(service-worker-controller) PUT "/${u}/configuration/" endpoint registered.`),p(`/${u}/configuration/update/`,async()=>T({configurationFilePath:this.configurationFilePath,serviceWorkerController:this}).then(()=>this.onInstall()).then(()=>this.onActivate()).then(()=>new Response(null,{status:200,statusText:"Configuration updated."})).catch(e=>(console.error("Failed to update configuration: ",e),new Response(null,{status:500,statusText:"Failed to update configuration."}))),"GET"),this.logger(`(service-worker-controller) GET "/${u}/configuration/update/" endpoint registered.`),p(()=>!0,this.routeHandler.bind(this),"GET"),p(()=>!0,this.routeHandler.bind(this),"POST"),p(()=>!0,this.routeHandler.bind(this),"DELETE"),p(()=>!0,this.routeHandler.bind(this),"PUT"),p(()=>!0,this.routeHandler.bind(this),"PATCH"),p(()=>!0,this.routeHandler.bind(this),"HEAD")}async routeHandler({event:e}){const n=await this.getConfiguration(),r=await Y(this.routes,async({matcher:a,method:i})=>await a({event:e,configuration:n})&&i===e.request.method);return r?r.handler({event:e,serviceWorkerController:this}).catch(()=>this.handlerDidError(e)):fetch(e.request).catch(()=>this.handlerDidError(e))}async logger(e){const{debugMode:n}=await this.getConfiguration().catch(()=>!1);n&&console.info(`[451 Tools] ${e}`)}}f=new WeakMap;const ct=()=>new st,oe=ct();je({serviceWorkerController:oe});Ye({serviceWorkerController:oe});
