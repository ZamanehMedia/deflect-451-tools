var W=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},L=(r,e,t)=>(W(r,e,"read from private field"),t?t.call(r):e.get(r)),Z=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},P=(r,e,t,n)=>(W(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);try{self["workbox:core:7.0.0"]&&_()}catch{}const X=(r,...e)=>{let t=r;return e.length>0&&(t+=` :: ${JSON.stringify(e)}`),t},Q=X;class g extends Error{constructor(e,t){const n=Q(e,t);super(n),this.name=e,this.details=t}}try{self["workbox:routing:7.0.0"]&&_()}catch{}const U="GET",R=r=>r&&typeof r=="object"?r:{handle:r};class C{constructor(e,t,n=U){this.handler=R(t),this.match=e,this.method=n}setCatchHandler(e){this.catchHandler=R(e)}}class ee extends C{constructor(e,t,n){const a=({url:s})=>{const o=e.exec(s.href);if(o)return s.origin!==location.origin&&o.index!==0?void 0:o.slice(1)};super(a,t,n)}}const te=r=>new URL(String(r),location.href).href.replace(new RegExp(`^${location.origin}`),"");class re{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",e=>{const{request:t}=e,n=this.handleRequest({request:t,event:e});n&&e.respondWith(n)})}addCacheListener(){self.addEventListener("message",e=>{if(e.data&&e.data.type==="CACHE_URLS"){const{payload:t}=e.data,n=Promise.all(t.urlsToCache.map(a=>{typeof a=="string"&&(a=[a]);const s=new Request(...a);return this.handleRequest({request:s,event:e})}));e.waitUntil(n),e.ports&&e.ports[0]&&n.then(()=>e.ports[0].postMessage(!0))}})}handleRequest({request:e,event:t}){const n=new URL(e.url,location.href);if(!n.protocol.startsWith("http"))return;const a=n.origin===location.origin,{params:s,route:o}=this.findMatchingRoute({event:t,request:e,sameOrigin:a,url:n});let i=o&&o.handler;const c=e.method;if(!i&&this._defaultHandlerMap.has(c)&&(i=this._defaultHandlerMap.get(c)),!i)return;let d;try{d=i.handle({url:n,request:e,event:t,params:s})}catch(l){d=Promise.reject(l)}const h=o&&o.catchHandler;return d instanceof Promise&&(this._catchHandler||h)&&(d=d.catch(async l=>{if(h)try{return await h.handle({url:n,request:e,event:t,params:s})}catch(u){u instanceof Error&&(l=u)}if(this._catchHandler)return this._catchHandler.handle({url:n,request:e,event:t});throw l})),d}findMatchingRoute({url:e,sameOrigin:t,request:n,event:a}){const s=this._routes.get(n.method)||[];for(const o of s){let i;const c=o.match({url:e,sameOrigin:t,request:n,event:a});if(c)return i=c,(Array.isArray(i)&&i.length===0||c.constructor===Object&&Object.keys(c).length===0||typeof c=="boolean")&&(i=void 0),{route:o,params:i}}return{}}setDefaultHandler(e,t=U){this._defaultHandlerMap.set(t,R(e))}setCatchHandler(e){this._catchHandler=R(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new g("unregister-route-but-not-found-with-method",{method:e.method});const t=this._routes.get(e.method).indexOf(e);if(t>-1)this._routes.get(e.method).splice(t,1);else throw new g("unregister-route-route-not-registered")}}let k;const I=()=>(k||(k=new re,k.addFetchListener(),k.addCacheListener()),k);function v(r,e,t){let n;if(typeof r=="string"){const a=new URL(r,location.href),s=({url:o})=>o.href===a.href;n=new C(s,e,t)}else if(r instanceof RegExp)n=new ee(r,e,t);else if(typeof r=="function")n=new C(r,e,t);else if(r instanceof C)n=r;else throw new g("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return I().registerRoute(n),n}function ne(r){I().setDefaultHandler(r)}const b="451-tools",ae=()=>({});function N(r,e){return e?`${r}?revision=${e}`:r}const se=r=>{if(!r||!r.pages)throw new Error("Missing contentBundles.pages in configuration.");return{pages:(Array.isArray(r.pages)?r.pages:[r.pages]).map(e=>{const{metadata:t={}}=e;return typeof e=="string"?{url:e,revision:null,metadata:t}:{url:e.url,revision:e.revision||null,metadata:t}})}},oe=r=>{if(!r||!r.assets)throw new Error("Missing fallbackAssets.assets in configuration.");return{assets:(Array.isArray(r.assets)?r.assets:[r.assets]).map(e=>typeof e=="string"?{url:e,revision:null}:{url:e.url,revision:e.revision||null})}},ie=()=>({});function ce({language:r,textDirection:e,templateStrings:t,mainCSS:n,mainJS:a}){return{"{{ language }}":r,"{{ textDirection }}":e,"{{ mainCSS }}":n,"{{ mainJS }}":a,"{{ pageTitle }}":(t==null?void 0:t.pageTitle)||"451 Tools","{{ pageDescription }}":(t==null?void 0:t.pageDescription)||"Censorship Resilient and Distributed Publishing","{{ homeLinkText }}":(t==null?void 0:t.homeLinkText)||"Home","{{ bookmarksTabTitle }}":(t==null?void 0:t.bookmarksTabTitle)||"Bookmarks","{{ editorialTabTitle }}":(t==null?void 0:t.editorialTabTitle)||"Editorial","{{ aboutTabTitle }}":(t==null?void 0:t.aboutTabTitle)||"About","{{ copyright }}":(t==null?void 0:t.copyright)||`Copyright Â© ${new Date().getFullYear()}, Zamaneh Media. All rights reserved.`,"{{ aboutInnerHTML }}":(t==null?void 0:t.aboutInnerHTML)||`
      <p>You are on the 451 Tools offline dashboard. This could be because you are experiencing an internet shutdown or your device is not connected to the internet. 451 Tools keeps information available even when the website is censored or when the internet is down.</p>
      <p>451 Tools helps publishers maintain reach and readership under the most adversarial circumstances. Find out more at <a href="https://451.tools/" target="_blank">https://451.tools/</a>.</p>
    `}}const le='<!doctypehtml><html lang="{{ language }}"dir="{{ textDirection }}"><meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1"><meta name="description"content="{{ pageDescription }}"><title>{{ pageTitle }}</title><style>{{ mainCSS }}</style><div class="container"><header class="header"><a class="home-link"href="/"><svg xmlns="http://www.w3.org/2000/svg"fill="currentColor"viewBox="0 0 16 16"width="28"height="28"><path d="M8 1.32.66 8.133l.68.734.66-.613V14h5V9h2v5h5V8.254l.66.613.68-.734Zm0 1.36 5 4.648V13h-3V8H6v5H3V7.328Z"/></svg> <span class="link-text">{{ homeLinkText }}</span></a><h1 class="title">{{ pageTitle }}</h1><p class="description">{{ pageDescription }}</p><svg class="offline-icon"xmlns="http://www.w3.org/2000/svg"viewBox="0 0 500 500"aria-hidden="true"><path d="M355.5 105.5c11.4 36.1 17.7 73.6 18.7 111.4 4.3.5 8.5 1.1 12.6 2h69.8c-3.2-52.6-25.4-102.2-62.1-139.9-12.2 10-25.3 18.9-39 26.5M99 405.2c.7.7 1.5 1.3 2.1 1.8 2.1 1.6 4.4 3.1 6.5 4.7 3.2 2.3 6.5 4.5 9.7 6.6 2.3 1.5 4.7 2.8 6.9 4.2 3.4 1.9 6.6 3.9 10 5.6 2.4 1.3 4.9 2.5 7.4 3.7 3.2 1.6 6.8 3.1 10 4.7 2.4 1 4.7 2 7.1 2.8-12.9-16.2-23.6-34.1-31.5-53.4-10 5.7-19.3 12.1-28.2 19.3m171.2-158.9h-19.9v19.2c6-7 12.7-13.4 19.9-19.2m175.6.2c3.6 2.8 7 5.8 10.2 9 .3-3 .6-6 .8-9h-11M250.3 13.8v94.1c24.3-1.5 48-6.9 70.4-16.3-17.6-41.8-42.6-70.5-70.4-77.8m123.9 46.4-2.1-1.8c-2.1-1.6-4.4-3.1-6.5-4.7-3.2-2.3-6.5-4.5-9.7-6.6-2.3-1.5-4.7-2.7-6.9-4.2-3.4-1.9-6.6-3.9-10-5.7-2.5-1.3-4.9-2.5-7.4-3.7-3.2-1.6-6.8-3.2-10-4.7-2.4-1-4.7-1.9-7.1-2.7 13 16.2 23.6 34.1 31.5 53.4 9.9-5.7 19.3-12.2 28.2-19.3M250.3 218.8h78.8c5.7-1.2 11.5-2 17.4-2.4-1.2-33.5-6.6-66.7-16.4-98.8-25.4 10.3-52.4 16.3-79.7 17.8l-.1 83.4m-27.5 232.6v-51.7c-4.1-13.1-6.3-26.7-6.4-40.4V358c-22 2-43.5 7.2-63.9 15.7 17.6 41.6 42.5 70.4 70.3 77.7m-105.1-91.5c-11.6-36.7-18-74.9-18.7-113.4H16.6c3.2 52.6 25.4 102.2 62.1 139.9 12.2-10 25.3-18.9 39-26.5M16.3 218.8h82.5c1-38.5 7.1-76.7 18.7-113.4-13.8-7.6-26.8-16.5-39-26.5-36.7 37.7-58.6 87.4-62.2 139.9m235.3 232.1c-.4-.5-.8-1-1.3-1.5v2c.5-.1.9-.3 1.4-.4 0-.1-.1-.1-.1-.1m-125-204.4c1 34.3 6.5 68.4 16.5 101.3 24.2-9.9 49.9-15.7 75.9-17.5.2-1.2.4-2.4.7-3.5.9-3.9 1.9-7.8 3.1-11.6v-68.7h-96.2M159 26.2c-2.4.8-4.7 1.8-7.1 2.7-3.5 1.5-6.9 2.9-10.3 4.5-2.5 1.2-5 2.4-7.4 3.7-3.4 1.6-6.6 3.6-9.9 5.5-2.4 1.5-4.9 2.9-7.1 4.4-3.3 2.1-6.4 4.3-9.6 6.6-2.1 1.6-4.4 3.2-6.5 4.9-.6.5-1.3 1.1-1.9 1.8 8.9 7.3 18.4 13.6 28.3 19.2 7.8-19.1 18.5-37.1 31.5-53.3m-6.5 65.5c22.4 9.2 46.2 14.7 70.3 16.2v-94c-27.8 7.3-52.7 36.3-70.3 77.8m70.3 43.7c-27.5-1.5-54.3-7.4-79.7-17.8-10 32.8-15.5 66.9-16.5 101.2h96.2v-83.4m246.4 163.3c-6.1-11.7-14-22.4-23.3-31.7-10.7-10.7-23.3-19.4-37.1-25.7l-2.1-.9c-15.7-6.8-33-10.6-51.2-10.6-18.1 0-35.3 3.7-50.9 10.5-37.3 16.1-65.4 49.4-74.3 89.9-2.1 9.7-3.2 19.6-3 29.5.2 13.2 2.4 26.4 6.6 39 5.4 16.2 14 31.2 25.3 44 12.7 14.5 28.5 25.9 46.3 33.5 15.4 6.5 32.3 10.1 50.1 10.1 70.8 0 128.2-57.4 128.2-128.2-.1-21.5-5.3-41.6-14.6-59.4zm-43.9 107-22.1 22.1-47.7-47.7-47.7 47.7-22.1-22.1 47.7-47.7-47.7-47.7 22.1-22.1 47.7 47.7 47.7-47.7 22.1 22.1-47.7 47.7 47.7 47.7z"/></svg></header><main class="main-content"><div class="tabs"role="tablist"><button aria-controls="panel-1"aria-selected="false"class="tab tab__hidden"id="tab-1"role="tab"tabindex="-1"disabled="disabled">{{ bookmarksTabTitle }}</button> <button aria-controls="panel-2"aria-selected="false"class="tab tab__hidden"id="tab-2"role="tab"tabindex="-1"disabled="disabled">{{ editorialTabTitle }}</button> <button aria-controls="panel-3"aria-selected="false"class="tab"id="tab-3"role="tab"tabindex="-1">{{ aboutTabTitle }}</button></div><section aria-labelledby="tab-1"class="tab-content"data-bookmarks hidden id="panel-1"role="tabpanel"tabindex="0"></section><section aria-labelledby="tab-2"class="tab-content"data-editorial hidden id="panel-2"role="tabpanel"tabindex="0"></section><section aria-labelledby="tab-3"class="tab-content rich-text"hidden id="panel-3"role="tabpanel"tabindex="0">{{ aboutInnerHTML }}</section></main><footer><p class="copyright">{{ copyright }}</footer></div><script>{{ mainJS }}<\/script>',M='*,::after,::before{box-sizing:border-box}*{margin:0}body,html{height:100%}body{-webkit-font-smoothing:antialiased;background-color:var(--background-color,#f9fbfc);color:var(--text-color,#2d2d3b);font-family:system-ui,sans-serif;line-height:1.4}.container{display:flex;flex-direction:column;height:100%;margin:0 auto;max-width:var(--container-width,1200px);padding:0 2rem;width:100%}.header{margin:4rem 0 2.5rem;position:relative}.home-link{display:flex;align-items:center;gap:.5rem;color:var(--primary-color,#1993f6);margin-block-end:1rem;text-decoration:none}.home-link:hover .link-text{text-decoration:underline}.home-link svg{width:28px;height:28px}.title{font-size:2.75rem;line-height:1;margin-block-end:1.5rem}@media screen and (min-width:960px){.title{font-size:5rem}}.description{font-size:1.25rem;max-width:40rem}.offline-icon{display:none;fill:var(--icon-color,#e6e8ec);height:100%;position:absolute;inset-inline-end:0;inset-block-start:0;z-index:-1}@media screen and (min-width:960px){.offline-icon{display:initial}}.main-content{flex-grow:1}.tabs{display:flex;flex-direction:row;flex-wrap:wrap;list-style:none;margin-block-end:2rem;padding:0}@media screen and (min-width:485px){.tabs{border-block-end:1px solid var(--border-color,#e6e8ec);flex-wrap:nowrap;overflow:auto}}.tab{appearance:none;background:0 0;border:none;border-block-end:2px solid transparent;box-shadow:0 1px 0 0 var(--border-color,#e6e8ec);color:var(--tab-text-color,#7a7d95);cursor:pointer;font:inherit;font-size:1.25rem;font-weight:700;padding:.5rem 1rem;transition:border-color .2s ease-in-out;width:50%}@media screen and (min-width:485px){.tab{box-shadow:none;width:initial}}.tab__hidden{display:none}.tab:disabled{cursor:not-allowed;opacity:.5;order:1}.tab:disabled::before{content:"ðŸ”’";margin-inline-end:.25rem}.tab[aria-selected=true]{border-color:var(--primary-color,#1993f6);color:var(--primary-color,#1993f6)}.tab:hover:not(:disabled){border-color:var(--primary-color,#1993f6)}.rich-text{max-width:40rem}.rich-text>*+*{margin-block-start:1.5rem}.rich-text h2,.rich-text h3{line-height:1.25}.rich-text h2{font-size:2.25rem}@media screen and (min-width:960px){.rich-text h2{font-size:2.75rem}}.rich-text h3{font-size:1.75rem}@media screen and (min-width:960px){.rich-text h3{font-size:2.25rem}}.rich-text a{color:var(--primary-color,#1993f6)}.rich-text blockquote{border-inline-start:0.25rem solid var(--primary-color,#1993f6);padding-inline-start:1rem}.rich-text cite,.rich-text figcaption{display:block;font-style:italic;margin-block-start:0.5rem}.rich-text figcaption{text-align:center}.rich-text img{display:block;margin-inline-start:auto;margin-inline-end:auto;max-width:100%}.rich-text ol,.rich-text ul{list-style-position:inside;padding:0}.bookmarks,.content-bundles{display:flex;flex-wrap:wrap;gap:1.5rem;list-style:none;padding:0}.card{background-color:var(--card-background-color,#fff);border-radius:.5rem;border:1px solid var(--border-color,#e6e8ec);box-shadow:var(--card-box-shadow,0 8px 24px rgba(149,157,165,.2));width:100%}@media screen and (min-width:960px){.card{width:calc(50% - .75rem)}}.card-link{border-radius:.5rem;color:inherit;display:flex;height:100%;overflow:hidden;text-decoration:none;transition:box-shadow .2s ease-in-out}.card-link:hover{box-shadow:0 0 0 2px var(--primary-color,#1993f6)}.card-image{flex-shrink:0;height:100%;min-height:100px;object-fit:cover;width:100px}.card-image[src=""]{display:none}.card-content{padding:1rem}.card-title{font-size:1.25rem}.card-description,.card-title{-webkit-box-orient:vertical;-webkit-line-clamp:2;display:-webkit-box;overflow-wrap:break-word;overflow:hidden;word-break:break-word}.card-description:not(:empty){-webkit-line-clamp:3;margin-block-start:0.5rem}.copyright{margin:2rem 0;text-align:center}',de=`(async function(){const bookmarksPlaceholder=document.querySelector("[data-bookmarks]");const serviceWorkerRegistration=await navigator.serviceWorker.getRegistration();if(!serviceWorkerRegistration){return}let configuration;try{configuration=await caches.open("configuration").then((cache=>cache.match("/configuration.json"))).then((res=>res.json()))}catch{configuration={}}if(configuration.bookmark){const bookmarks=await fetch("/451-tools/bookmark/").then((res=>res.json())).catch((()=>[]));if(bookmarks.length<1){renderNoBookmarks()}else{const bookmarksList=document.createElement("ul");const bookmarksHtml=bookmarks.map(generateCardHtml).join("");bookmarksList.innerHTML=bookmarksHtml;bookmarksList.classList.add("bookmarks");bookmarksPlaceholder.appendChild(bookmarksList)}const bookmarksTab=document.querySelector("#tab-1");bookmarksTab.classList.remove("tab__hidden");bookmarksTab.removeAttribute("disabled")}else if(configuration.fallbackPages.showHiddenTabs){const bookmarksTab=document.querySelector("#tab-1");bookmarksTab.classList.remove("tab__hidden")}function renderNoBookmarks(){const noBookmarksMessage=document.createElement("p");noBookmarksMessage.innerText="You have no bookmarks.";bookmarksPlaceholder.appendChild(noBookmarksMessage)}const contentBundlesPlaceholder=document.querySelector("[data-editorial]");const isContentBundlesUsed=await caches.has("content-bundles");if(isContentBundlesUsed){const contentBundles=await caches.open("content-bundles").then((cache=>cache.keys())).then((requests=>Promise.all(requests.map((async request=>{const response=await caches.match(request);const html=await response.text();return{path:new URL(request.url).pathname,url:request.url.split("?")[0],html:html}})))));if(contentBundles.length<1){renderNoContentBundles()}else{const contentBundlesList=document.createElement("ul");const contentBundlesHtml=contentBundles.reverse().map(generateCardHtml).join("");contentBundlesList.innerHTML=contentBundlesHtml;contentBundlesList.classList.add("content-bundles");contentBundlesPlaceholder.appendChild(contentBundlesList)}const contentBundlesTab=document.querySelector("#tab-2");contentBundlesTab.classList.remove("tab__hidden");contentBundlesTab.removeAttribute("disabled")}else if(configuration.fallbackPages.showHiddenTabs){const contentBundlesTab=document.querySelector("#tab-2");contentBundlesTab.classList.remove("tab__hidden")}function renderNoContentBundles(){const noContentBundlesMessage=document.createElement("p");noContentBundlesMessage.innerText="You have no content bundles.";contentBundlesPlaceholder.appendChild(noContentBundlesMessage)}function generateCardHtml(response){const cardItem=document.createElement("li");const cardLink=document.createElement("a");const cardImage=document.createElement("img");const cardContent=document.createElement("div");const cardTitle=document.createElement("h2");const cardDescription=document.createElement("p");const html=document.createElement("html");html.innerHTML=response.html;const title=response.metadata?.title||html.querySelector("title")?.innerText||response.url;const description=response.metadata?.description||html.querySelector('meta[name="description"]')?.content||"";const imageSrc=response.metadata?.image?.src||html.querySelector('meta[property="og:image"]')?.content||"";cardItem.classList.add("card");cardLink.classList.add("card-link");cardLink.href=response.path;cardImage.classList.add("card-image");cardImage.src=imageSrc;if(Number.isInteger(response.metadata?.image?.height)){cardImage.height=response.metadata.image.height}if(Number.isInteger(response.metadata?.image?.width)){cardImage.width=response.metadata.image.width}cardImage.alt="";cardContent.classList.add("card-content");cardTitle.classList.add("card-title");cardTitle.innerText=title;cardDescription.classList.add("card-description");cardDescription.innerText=description;cardContent.appendChild(cardTitle);cardContent.appendChild(cardDescription);cardLink.appendChild(cardImage);cardLink.appendChild(cardContent);cardItem.appendChild(cardLink);return cardItem.outerHTML}const activeTabs=Array.from(document.querySelectorAll('[role="tab"]')).filter((tab=>!tab.classList.contains("tab__hidden")&&!tab.hasAttribute("disabled")));const firstActiveTab=activeTabs[0];const firstActivePanel=document.querySelector(\`#\${firstActiveTab.getAttribute("aria-controls")}\`);const tabList=document.querySelector('[role="tablist"]');firstActiveTab.setAttribute("aria-selected",true);firstActiveTab.setAttribute("tabindex",0);firstActivePanel.removeAttribute("hidden");activeTabs.forEach((tab=>tab.addEventListener("click",changeTabs)));let currentTabIndex=0;tabList.addEventListener("keydown",(e=>{if(e.key==="ArrowRight"||e.key==="ArrowLeft"){activeTabs[currentTabIndex].setAttribute("tabindex",-1);if(e.key==="ArrowRight"){currentTabIndex++;if(currentTabIndex>=activeTabs.length){currentTabIndex=0}}else if(e.key==="ArrowLeft"){currentTabIndex--;if(currentTabIndex<0){currentTabIndex=activeTabs.length-1}}activeTabs[currentTabIndex].setAttribute("tabindex",0);activeTabs[currentTabIndex].focus()}}));function changeTabs(e){const target=e.target;const parent=target.parentNode;const grandparent=parent.parentNode;parent.querySelectorAll('[aria-selected="true"]').forEach((t=>t.setAttribute("aria-selected",false)));target.setAttribute("aria-selected",true);grandparent.querySelectorAll('[role="tabpanel"]').forEach((p=>p.setAttribute("hidden",true)));grandparent.parentNode.querySelector(\`#\${target.getAttribute("aria-controls")}\`).removeAttribute("hidden")}})();
`,ue=async(r={})=>{const{serviceWorkerController:e}=r;if(!e)throw new Error("You must pass a serviceWorkerController plugin to registerFallbackPages");e.modules.push("fallbackPages"),e.logger("(fallback-pages) Module registered."),e.addInstallHandler(he),e.addActivateHandler(me),e.addFallbackHandler(O),v(new RegExp(`/${b}/dashboard/?$`),async()=>{const{fallbackPages:t}=await e.getConfiguration(),{language:n,textDirection:a,customProperties:s,templateStrings:o}=t;return new Response($({language:n,textDirection:a,customProperties:s,templateStrings:o}),{headers:{"Content-Type":"text/html"}})})};async function he({serviceWorkerController:r}){const{fallbackPages:e}=await r.getConfiguration();if(e)return e.pages.map(t=>{const n=N(t.url,t.revision);return Promise.all([caches.open("fallback-pages").then(a=>a.add(n))])})}async function me({serviceWorkerController:r}){const{fallbackPages:e}=await r.getConfiguration(),t=e==null?void 0:e.pages.map(n=>N(n.url,n.revision));return caches.open("fallback-pages").then(n=>n.keys().then(a=>{a.forEach(s=>{const o=s.url.replace(self.location.origin,"");if(!t.includes(o))return n.delete(s)})}))}async function O({url:r,request:e,serviceWorkerController:t}){if(e.destination!=="document")return;const{fallbackPages:n}=await t.getConfiguration(),{pages:a,language:s,textDirection:o,customProperties:i,templateStrings:c}=n;if(a.length<1)return t.logger("(fallback-pages) No custom fallback pages configured. Returning the default fallback page."),new Response($({language:s,textDirection:o,customProperties:i,templateStrings:c}),{headers:{"Content-Type":"text/html"}});const d=a.find(l=>l.refererRegex?new RegExp(l.refererRegex).test(e.headers.get("referer")):!1),h=d?d.url:a.find(l=>!l.refererRegex).url;return caches.open("fallback-pages").then(l=>l.match(h,{ignoreSearch:!0}).then(u=>(u&&t.logger("(fallback-pages) Custom fallback page found. Returning cached response."),u)))}function $({language:r,textDirection:e,customProperties:t,templateStrings:n}){const a=t?`:root { ${Object.entries(t).map(([o,i])=>`--${o}: ${i};`).join(" ")} } ${M}`:M,s=ce({language:r,textDirection:e,templateStrings:n,mainCSS:a,mainJS:de});return le.replace(/{{\s?(.*?)\s?}}/g,(o,i)=>s[o]||o)}const fe=r=>{const e=(r==null?void 0:r.customProperties)||{},t=(r==null?void 0:r.templateStrings)||{},n=(r==null?void 0:r.language)||"en",a=(r==null?void 0:r.textDirection)||"ltr",s=(r==null?void 0:r.showHiddenTabs)||!1,o=(r!=null&&r.pages?Array.isArray(r.pages)?r.pages:[r.pages]:[]).map(i=>typeof i=="string"?{url:i,revision:null,refererRegex:null}:{url:i.url,revision:i.revision||null,refererRegex:i.refererRegex||null});return{language:n,textDirection:a,customProperties:e,templateStrings:t,showHiddenTabs:s,pages:o}};function ge(r){const e=JSON.stringify(r);return self.clients.matchAll().then(t=>Promise.all(t.map(n=>(n.postMessage(e),Promise.resolve("postMessage sent, ",e)))))}const F="mirrors",z="/mirrors.json",pe=10*60*1e3,p="up",E="down";async function y(){return caches.open(F).then(r=>r.match(z)).then(r=>r.json())}async function A(r){await caches.open(F).then(e=>e.put(z,new Response(JSON.stringify(r),{headers:{"Content-Type":"application/json"}})))}async function B(r,e){const t=await y(),n=t.find(o=>o.url===r),a={...n,lastModified:Date.now(),status:e},s=[...t.filter(o=>o.url!==r),a];await A(s).then(()=>{n.status!==e&&ge({type:"mirror-status-changed",mirror:r,status:e})})}async function be(){const r=Date.now(),e=await y(),t=e.every(a=>a.status===E);let n;t?n=e.map(a=>({...a,lastModified:r,status:p})):n=e.map(a=>a.lastModified<r-pe?{...a,lastModified:r,status:p}:a),await A(n)}async function D(){const r=(await y()).filter(e=>e.status===p);return r.find(e=>e.isPrimary)||r[0]}async function J(r,e){const t=new URL(r.url),n=t.pathname,a=t.searchParams,s=r.destination==="document",{mirroring:o}=await e.getConfiguration(),i=o.timeout??3e3,c=n.replace(/^\//,"");let d=[];const h=(await y()).find(u=>u.isPrimary);s&&await be();let l=await D();for(;l;){const u=l.url,x=new URL(c,u);x.search=a.toString();const H=new AbortController;try{const w=await Promise.race([we(i),fetch(new Request(x,{...r,headers:{...r.headers,"X-Repress-Mode":"mirror","X-Repress":h.url},signal:H.signal}))]),q=new Headers(w.headers);return q.append("x-mirror",u),q.append("x-time-cached",Date.now()),await B(u,p),e.logger(`(mirroring) Request successful on mirror: ${u}, URL: ${x}`),new Response(w.body,{...w,headers:q})}catch(w){H.abort(),d.push(w),await B(u,E),e.logger(`(mirroring) Request failed on mirror: ${u}, URL: ${x}`)}l=await D()}return Promise.reject(new Error("networking.js (fetchFromNetwork): Out of mirrors.",{cause:d}))}function we(r){return new Promise((e,t)=>{setTimeout(()=>{t(new Response("",{status:408,statusText:"Request Timeout"}))},r)})}const ke=async(r={})=>{const{serviceWorkerController:e}=r;if(!e)throw new Error("You must pass a serviceWorkerController plugin to registerMirroring");e.modules.push("mirroring"),e.logger("(mirroring) Module registered"),e.addInstallHandler(ve),v(xe,Ce(e),"GET"),v(Te,Re(e),"GET"),v(`/${b}/mirror-status/`,qe(),"GET"),e.logger(`(mirroring) GET "/${b}/mirror-status/" endpoint registered.`)};async function ve({serviceWorkerController:r}){const{mirroring:e}=await r.getConfiguration(),{urls:t}=e,n=t.map(a=>{const s=Date.now();return{url:a.url,lastModified:s,status:p,isPrimary:a.isPrimary}});return A(n)}const ye=r=>{const e=self.location.origin,t=(r==null?void 0:r.urls)||[];return{urls:[{url:e,isPrimary:!0},...t.map(n=>({url:n,isPrimary:!1}))],excludeByPath:(r==null?void 0:r.excludeByPath)||[],timeout:(r==null?void 0:r.timeout)||3e3}};function xe(r){return r.request.destination==="document"}function Te(r){const e=new URL(r.request.url).pathname;return r.request.method==="GET"&&new URL(r.request.url).origin===new URL(self.registration.scope).origin&&!e.startsWith(`/${b}`)}const V=(r,e)=>{const t=new URL(r.url).pathname;return e.some(n=>{try{return new RegExp(n).test(t)}catch{return!1}})};function Ce(r){return async e=>{const t=await r.getConfiguration(),{fallbackPages:n,mirroring:a}=t,{request:s}=e;return V(s,a.excludeByPath)?fetch(s):J(s,r).catch(async o=>{r.logger(`(mirroring) All mirrors failed. Reverting to offline fallback handling for URL: ${s.url}`);const i=await r.handlerDidError({event:e,request:s});if(i)return i;if(n)return O({event:e,request:s,serviceWorkerController:r})})}}function Re(r){return async e=>{const{request:t}=e,{mirroring:n}=await r.getConfiguration();return V(t,n.excludeByPath)?fetch(t):J(t,r).catch(async()=>{r.logger(`(mirroring) All mirrors failed. Reverting to offline fallback handling for URL: ${t.url}`);const a=await r.handlerDidError({event:e,request:t});if(a)return a})}}function qe(){return async()=>{let r="unknown";const e=await y(),t=e.find(s=>s.isPrimary&&s.status===p),n=e.find(s=>s.status===p),a=e.every(s=>s.status===E);return t?r="up":n?r="low":a&&(r="down"),new Response(JSON.stringify({status:r}),{status:200,headers:{"Content-Type":"application/json"}})}}const _e="configuration";async function Le({configurationFilePath:r,serviceWorkerController:e}){return fetch(r,{cache:"no-store"}).then(async t=>{if(t.ok){const n=await t.json();return G({configuration:n,serviceWorkerController:e})}return Promise.reject(new Error("Configuration file not found"))})}async function G({configuration:r,serviceWorkerController:e}){const{modules:t}=e;return caches.open(_e).then(async n=>{const a={...r,...t.includes("bookmark")&&{bookmark:ae()},...t.includes("fallbackPages")&&{fallbackPages:fe(r.fallbackPages)},...t.includes("fallbackImage")&&{fallbackImage:ie()},...t.includes("fallbackAssets")&&{fallbackAssets:oe(r.fallbackAssets)},...t.includes("contentBundles")&&{contentBundles:se(r.contentBundles)},...t.includes("mirroring")&&{mirroring:ye(r.mirroring)},debugMode:r.debugMode||!1},s=new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}});return await n.put("/configuration.json",s.clone()),s})}var f;class Pe{constructor(){Z(this,f,{}),this.modules=[],this.installHandlers=[],this.activateHandlers=[],this.fallbackHandlers=[],this.init()}async getConfiguration(){return Object.entries(L(this,f)).length?L(this,f):caches.open("configuration").then(e=>e.match("/configuration.json")).then(async e=>e?(P(this,f,await e.json()),L(this,f)):Promise.reject(new Error("Configuration not found")))}addInstallHandler(e){this.installHandlers.push(e)}addActivateHandler(e){this.activateHandlers.push(e)}addFallbackHandler(e){this.fallbackHandlers.push(e)}async handlerDidError({request:e,event:t,error:n,state:a}){let s;for(const o of this.fallbackHandlers){const i=new URL(e.url),c=await o({event:t,request:e,url:i,serviceWorkerController:this});if(c){s=c;break}}return s||Response.error()}init(){self.addEventListener("install",e=>{const t=new URL(self.location).searchParams.get("configuration");t?e.waitUntil(Le({configurationFilePath:t,serviceWorkerController:this}).then(n=>n.json()).then(async n=>(P(this,f,n),Promise.all(this.installHandlers.map(a=>a({serviceWorkerController:this}))))).then(()=>self.skipWaiting())):e.waitUntil(Promise.all(this.installHandlers.map(n=>n({serviceWorkerController:this}))).then(()=>self.skipWaiting()))}),self.addEventListener("activate",e=>{e.waitUntil(Promise.all(this.activateHandlers.map(t=>t({serviceWorkerController:this}))).then(()=>self.clients.claim()))}),this.logger("(service-worker-controller) Module registered."),v(`/${b}/configuration/`,async({request:e})=>{try{const t=await e.json(),n=await G(t).then(a=>a.json());return P(this,f,n),new Response(null,{status:200,statusText:"Configuration saved."})}catch{return new Response(null,{status:500,statusText:"Failed to save configuration."})}},"PUT"),this.logger(`(service-worker-controller) PUT "/${b}/configuration/" endpoint registered.`)}async logger(e){const{debugMode:t}=await this.getConfiguration().catch(()=>!1);t&&console.info(`[451 Tools] ${e}`)}}f=new WeakMap;const m={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:typeof registration<"u"?registration.scope:""},S=r=>[m.prefix,r,m.suffix].filter(e=>e&&e.length>0).join("-"),Se=r=>{for(const e of Object.keys(m))r(e)},Ee={updateDetails:r=>{Se(e=>{typeof r[e]=="string"&&(m[e]=r[e])})},getGoogleAnalyticsName:r=>r||S(m.googleAnalytics),getPrecacheName:r=>r||S(m.precache),getPrefix:()=>m.prefix,getRuntimeName:r=>r||S(m.runtime),getSuffix:()=>m.suffix};function j(r,e){const t=new URL(r);for(const n of e)t.searchParams.delete(n);return t.href}async function Ae(r,e,t,n){const a=j(e.url,t);if(e.url===a)return r.match(e,n);const s=Object.assign(Object.assign({},n),{ignoreSearch:!0}),o=await r.keys(e,s);for(const i of o){const c=j(i.url,t);if(a===c)return r.match(i,n)}}class He{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}const Me=new Set;async function Be(){for(const r of Me)await r()}function K(r){return new Promise(e=>setTimeout(e,r))}try{self["workbox:strategies:7.0.0"]&&_()}catch{}function T(r){return typeof r=="string"?new Request(r):r}class De{constructor(e,t){this._cacheKeys={},Object.assign(this,t),this.event=t.event,this._strategy=e,this._handlerDeferred=new He,this._extendLifetimePromises=[],this._plugins=[...e.plugins],this._pluginStateMap=new Map;for(const n of this._plugins)this._pluginStateMap.set(n,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(e){const{event:t}=this;let n=T(e);if(n.mode==="navigate"&&t instanceof FetchEvent&&t.preloadResponse){const o=await t.preloadResponse;if(o)return o}const a=this.hasCallback("fetchDidFail")?n.clone():null;try{for(const o of this.iterateCallbacks("requestWillFetch"))n=await o({request:n.clone(),event:t})}catch(o){if(o instanceof Error)throw new g("plugin-error-request-will-fetch",{thrownErrorMessage:o.message})}const s=n.clone();try{let o;o=await fetch(n,n.mode==="navigate"?void 0:this._strategy.fetchOptions);for(const i of this.iterateCallbacks("fetchDidSucceed"))o=await i({event:t,request:s,response:o});return o}catch(o){throw a&&await this.runCallbacks("fetchDidFail",{error:o,event:t,originalRequest:a.clone(),request:s.clone()}),o}}async fetchAndCachePut(e){const t=await this.fetch(e),n=t.clone();return this.waitUntil(this.cachePut(e,n)),t}async cacheMatch(e){const t=T(e);let n;const{cacheName:a,matchOptions:s}=this._strategy,o=await this.getCacheKey(t,"read"),i=Object.assign(Object.assign({},s),{cacheName:a});n=await caches.match(o,i);for(const c of this.iterateCallbacks("cachedResponseWillBeUsed"))n=await c({cacheName:a,matchOptions:s,cachedResponse:n,request:o,event:this.event})||void 0;return n}async cachePut(e,t){const n=T(e);await K(0);const a=await this.getCacheKey(n,"write");if(!t)throw new g("cache-put-with-no-response",{url:te(a.url)});const s=await this._ensureResponseSafeToCache(t);if(!s)return!1;const{cacheName:o,matchOptions:i}=this._strategy,c=await self.caches.open(o),d=this.hasCallback("cacheDidUpdate"),h=d?await Ae(c,a.clone(),["__WB_REVISION__"],i):null;try{await c.put(a,d?s.clone():s)}catch(l){if(l instanceof Error)throw l.name==="QuotaExceededError"&&await Be(),l}for(const l of this.iterateCallbacks("cacheDidUpdate"))await l({cacheName:o,oldResponse:h,newResponse:s.clone(),request:a,event:this.event});return!0}async getCacheKey(e,t){const n=`${e.url} | ${t}`;if(!this._cacheKeys[n]){let a=e;for(const s of this.iterateCallbacks("cacheKeyWillBeUsed"))a=T(await s({mode:t,request:a,event:this.event,params:this.params}));this._cacheKeys[n]=a}return this._cacheKeys[n]}hasCallback(e){for(const t of this._strategy.plugins)if(e in t)return!0;return!1}async runCallbacks(e,t){for(const n of this.iterateCallbacks(e))await n(t)}*iterateCallbacks(e){for(const t of this._strategy.plugins)if(typeof t[e]=="function"){const n=this._pluginStateMap.get(t);yield a=>{const s=Object.assign(Object.assign({},a),{state:n});return t[e](s)}}}waitUntil(e){return this._extendLifetimePromises.push(e),e}async doneWaiting(){let e;for(;e=this._extendLifetimePromises.shift();)await e}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(e){let t=e,n=!1;for(const a of this.iterateCallbacks("cacheWillUpdate"))if(t=await a({request:this.request,response:t,event:this.event})||void 0,n=!0,!t)break;return n||t&&t.status!==200&&(t=void 0),t}}class je{constructor(e={}){this.cacheName=Ee.getRuntimeName(e.cacheName),this.plugins=e.plugins||[],this.fetchOptions=e.fetchOptions,this.matchOptions=e.matchOptions}handle(e){const[t]=this.handleAll(e);return t}handleAll(e){e instanceof FetchEvent&&(e={event:e,request:e.request});const t=e.event,n=typeof e.request=="string"?new Request(e.request):e.request,a="params"in e?e.params:void 0,s=new De(this,{event:t,request:n,params:a}),o=this._getResponse(s,n,t),i=this._awaitComplete(o,s,n,t);return[o,i]}async _getResponse(e,t,n){await e.runCallbacks("handlerWillStart",{event:n,request:t});let a;try{if(a=await this._handle(t,e),!a||a.type==="error")throw new g("no-response",{url:t.url})}catch(s){if(s instanceof Error){for(const o of e.iterateCallbacks("handlerDidError"))if(a=await o({error:s,event:n,request:t}),a)break}if(!a)throw s}for(const s of e.iterateCallbacks("handlerWillRespond"))a=await s({event:n,request:t,response:a});return a}async _awaitComplete(e,t,n,a){let s,o;try{s=await e}catch{}try{await t.runCallbacks("handlerDidRespond",{event:a,request:n,response:s}),await t.doneWaiting()}catch(i){i instanceof Error&&(o=i)}if(await t.runCallbacks("handlerDidComplete",{event:a,request:n,response:s,error:o}),t.destroy(),o)throw o}}class We extends je{constructor(e={}){super(e),this._networkTimeoutSeconds=e.networkTimeoutSeconds||0}async _handle(e,t){let n,a;try{const s=[t.fetch(e)];if(this._networkTimeoutSeconds){const o=K(this._networkTimeoutSeconds*1e3);s.push(o)}if(a=await Promise.race(s),!a)throw new Error(`Timed out the network response after ${this._networkTimeoutSeconds} seconds.`)}catch(s){s instanceof Error&&(n=s)}if(!a)throw new g("no-response",{url:e.url,error:n});return a}}const Ue=()=>{const r=new Pe;return ne(new We({plugins:[r]})),r},Y=Ue();ue({serviceWorkerController:Y});ke({serviceWorkerController:Y});
